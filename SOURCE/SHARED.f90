!======================================================================!
MODULE SHARED
!----------------------------------------------------------------------!
IMPLICIT NONE
!----------------------------------------------------------------------!
SAVE
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
INTEGER, PARAMETER :: nsoil_layers_max = 8
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Number of ground layers                                            (n)
!----------------------------------------------------------------------!
INTEGER, PARAMETER :: Nlevgrnd = 9
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
INTEGER :: my_id             ! Processor ID                         (n).
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
REAL, PARAMETER :: zero = 0.0
REAL, PARAMETER :: one  = 1.0
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Physical constants                                            (ratio).
!----------------------------------------------------------------------!
REAL, PARAMETER :: pi = 3.14159
!----------------------------------------------------------------------!
! Density of pure water                                        (kg m-3).
!----------------------------------------------------------------------!
REAL, PARAMETER :: rhow = 1000.0
!----------------------------------------------------------------------!
! Molecular weight of dry air                                 (g mol-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: mair = 28.9655
!----------------------------------------------------------------------!
! Molecular weight of water vapour                            (g mol-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: mwat = 18.015
!----------------------------------------------------------------------!
! Gas constant                                            (J mol-1 K-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: gasc = 8.314510
!----------------------------------------------------------------------!
! Gas constant for air                              (287.05 J K-1 kg-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: rgas = 1000.0 * gasc / mair
!----------------------------------------------------------------------!
! Mass ratio of air to water vapour                           (0.62197).
!----------------------------------------------------------------------!
REAL, PARAMETER :: mrat = mwat / mair
!----------------------------------------------------------------------!
! 1.0 / mrat                                                   (1.6078).
!----------------------------------------------------------------------!
REAL, PARAMETER :: bymrat = one / mrat
!----------------------------------------------------------------------!
! Coefficient of humidity in virtual temperature definition    (0.6078).
!----------------------------------------------------------------------!
REAL, PARAMETER :: deltx = bymrat - one
!----------------------------------------------------------------------!
! Latent heat of evaporation at 0 oC                  (2.5008E6 J kg-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: lhe = 2.5008E6
!----------------------------------------------------------------------!
! Gas constant for water vapour                      (461.5 J K-1 kg-1).
!----------------------------------------------------------------------!
REAL, PARAMETER :: rvap = 1000.0 * gasc / mwat
!----------------------------------------------------------------------!
! Freezing point of water at 1 atm                           (273.16 K).
!----------------------------------------------------------------------!
REAL, PARAMETER :: tf = 273.16
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Global dimensions (no. grid boxes).
!----------------------------------------------------------------------!
INTEGER, PARAMETER :: NX = 720
INTEGER, PARAMETER :: NY = 360
REAL :: lon_all (NX)
REAL :: lat_all (NY)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! No. timesteps in input climate files.
!----------------------------------------------------------------------!
INTEGER :: NTIMES
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
INTEGER :: start_two (2)    ! Array position for start of netCDF write.
INTEGER :: count_two (2)    ! Array count for netCDF write.
INTEGER :: start_three (3)  ! Array position for start of netCDF write.
INTEGER :: count_three (3)  ! Array count for netCDF write.
INTEGER :: lon_s,lat_s      ! Array positions for start of chunk.
INTEGER :: lon_c,lat_c      ! Array counts for chunk.
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
INTEGER :: varid ! Variable ID.
!----------------------------------------------------------------------!
! Generic 2D input integer array.
!----------------------------------------------------------------------!
INTEGER, ALLOCATABLE :: data_in_2DI (:,:) 
!----------------------------------------------------------------------!
! Generic 3D input real array.
!----------------------------------------------------------------------!
REAL, ALLOCATABLE :: data_in_3DR (:,:,:)
!----------------------------------------------------------------------!
CHARACTER (LEN = 200) :: file_name         ! Generic filename.
CHARACTER (LEN = 200) :: var_name          ! Generic variable name.
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunks of soil properties of one soil layer read in at
! 30 arc-seconds.
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:), ALLOCATABLE :: theta_s_l1_in ! 0.001xcm^3/cm^3
REAL, DIMENSION (:,:), ALLOCATABLE :: k_s_l1_in     ! cm/day
REAL, DIMENSION (:,:), ALLOCATABLE :: lambda_l1_in  ! 0.001*unitless
REAL, DIMENSION (:,:), ALLOCATABLE :: psi_s_l1_in   ! cm
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunks of soil properties of one soil layer gridded to half-degree.
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:), ALLOCATABLE :: theta_s_l1 ! 0.001xcm^3/cm^-3
REAL, DIMENSION (:,:), ALLOCATABLE :: k_s_l1     ! cm/day
REAL, DIMENSION (:,:), ALLOCATABLE :: lambda_l1  ! 0.001*unitless
REAL, DIMENSION (:,:), ALLOCATABLE :: psi_s_l1   ! cm
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of saturated volumetric soil water (cm3 cm-3).
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: theta_s
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of saturated soil hydralaulic conductivity (mm/s).
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: k_s
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of pore size distribution index (unitless).
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: lambda
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of Clapp and Hornberger "b".
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: bsw
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of saturated capillary potential (mm).
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: psi_s
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk of minimum volumetric soil matric potential (cm3 cm-3).
!----------------------------------------------------------------------!
REAL, DIMENSION (:,:,:), ALLOCATABLE :: theta_m
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk arrays of longitudes and latitudes.
!----------------------------------------------------------------------!
REAL, ALLOCATABLE :: lon (:) ! Longitude (degrees east).
REAL, ALLOCATABLE :: lat (:) ! Latitude (degrees north).
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk arrays of processor IDs and soil textures.
!----------------------------------------------------------------------!
INTEGER, ALLOCATABLE :: block_sub (:,:) ! Processor IDs.
INTEGER, ALLOCATABLE :: soil_tex  (:,:) ! Soil texture.
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Soil layer node depths, positive downwards from surface = 0 mm    (mm)
!----------------------------------------------------------------------!
REAL, DIMENSION (:), ALLOCATABLE :: zsoi
REAL, DIMENSION (:), ALLOCATABLE :: zc
REAL, DIMENSION (:), ALLOCATABLE :: zc_o
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunk array of liquid soil water mass                         (kg/m^2)
!----------------------------------------------------------------------!
REAL, ALLOCATABLE :: h2osoi_liq (:,:,:)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Chunck arrays of diagnostics.
!----------------------------------------------------------------------!
REAL, ALLOCATABLE :: axy_rnf         (:,:,:)
REAL, ALLOCATABLE :: axy_evap        (:,:,:)
REAL, ALLOCATABLE :: axy_tas         (:,:,:)
REAL, ALLOCATABLE :: axy_huss        (:,:,:)
REAL, ALLOCATABLE :: axy_ps          (:,:,:)
REAL, ALLOCATABLE :: axy_pr          (:,:,:)
REAL, ALLOCATABLE :: axy_rhs         (:,:,:)
REAL, ALLOCATABLE :: axy_theta       (:,:,:,:)
REAL, ALLOCATABLE :: axy_theta_total (:,:,:)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Names of decades.
!----------------------------------------------------------------------!
CHARACTER (LEN =  9) :: decade   (12) &
&      = (/ '1901_1910','1911_1920','1921_1930','1931_1940', &
&           '1941_1950','1951_1960','1961_1970','1971_1980', &
&           '1981_1990','1991_2000','2001_2010','2011_2012'/)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
END MODULE SHARED
!======================================================================!
